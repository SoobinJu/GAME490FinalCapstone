using UnityEngine;
using UnityEngine.SceneManagement;
using TMPro;

public class SuspectHandler : MonoBehaviour
{
    public TextMeshProUGUI chancesText; // ?? ??? ?? UI ???
    public string correctSuspect = "A"; // ?? ???? ??

    private int chances = 3; // ? ?? ?

    private void Start()
    {
        // ?? ?? ? ?? ??? ????
        UpdateChancesText();
    }

    private void Update()
    {
        // ??? ?? ??
        if (Input.GetMouseButtonDown(0)) // ?? ??? ?? ??
        {
            DetectSuspectClick();
        }
    }

    private void DetectSuspectClick()
    {
        // ????? ??? ??? ?? ??? ?? ??
        Vector2 mousePosition = Camera.main.ScreenToWorldPoint(Input.mousePosition);
        RaycastHit2D hit = Physics2D.Raycast(mousePosition, Vector2.zero);

        if (hit.collider != null)
        {
            // ??? ????? ????? ??
            string clickedSuspectName = hit.collider.gameObject.name; // ??? ????? ?? ????
            ChooseSuspect(clickedSuspectName); // ??? ??? ??? ChooseSuspect ???? ??
        }
    }

    public void ChooseSuspect(string suspectName)
    {
        if (suspectName == correctSuspect)
        {
            // ??? ????
            Debug.Log("?????! ?? ??? ?????...");
            SceneManager.LoadScene("Narration2"); // ??? ?? ? ??
        }
        else
        {
            // ?? ? ?????
            chances--; // ?? 1 ??
            UpdateChancesText(); // UI ????
            Debug.Log("?????! ?? ??: " + chances);

            if (chances <= 0)
            {
                // ??? ?? ??? ??
                Debug.Log("?? ??! ?? ??? ????.");
                SceneManager.LoadScene("LoseScene"); // ?? ? ?? ? ?? ??? ???
            }
        }
    }

    private void UpdateChancesText()
    {
        // ?? ??? ????
        chancesText.text = "Chances: " + chances + "/3"; // ?? ?? ?? ??
    }
}
